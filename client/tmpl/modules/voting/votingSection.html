<template name="Module_Voting_Section">
  {{> Element_ProcessDimmer}}
  {{> Element_CloseSectionButton href='/voting'}}
  <div class="ui attached flex container" id="votingSection">
    {{#with voting}}
    <h1 class="ui header">
      {{title}}
      {{#if isNull voteExecuted}}
        <a class="ui red basic label">Ends in {{ timeRange now closingTime }}</a>
        {{#if supportNeeded}}
        <a class="ui violet label">Requires {{ percentFormat supportNeeded }} support</a>
        {{/if}}

        {{#if relativeMajorityOnClose}}
          <a class="ui violet basic label">Relative count on close</a>
        {{else}}
          <a class="ui violet label">Absolute count on close</a>
        {{/if}}
      {{else}}
        <a class="ui left pointing red basic label">Closed</a>
        <a class="ui violet label">{{arrayAccess options voteExecuted}}</a>
      {{/if}}
      <div class="sub header">{{description}}</div>
    </h1>

    <div class="ui hidden divider"></div>
    <label>Created by:</label>
    {{ > Element_MiniEntity entity=(getEntity creator) }}

    <table class="ui very basic padded fixed table" id="optionsTable">
      <thead>
        <tr>
          <th>Option</th>
          <th>Votes</th>
          <th>Percentage</th>
        </tr>
      </thead>
      <tbody>
        {{ #each options }}
        <tr data-option="{{ @index }}">
          <td>
            {{ this }}
          </td>
          {{#with arrayAccess voteCounts @index updatesHack }}
          <td>
            {{ votes }}
          </td>
          <td>
            {{ percentFormat relativeVotes }}
          </td>
          {{/with}}
        </tr>
        {{/each}}
        {{#unless isClosed this }}
        <tr>
          <td>Pending votes</td>
          {{#with pendingVotes options updatesHack }}
          <td>{{Â votes }}</td>
          <td>{{ percentFormat relativeVotes }}</td>
          {{/with}}
        </tr>
        {{/unless}}
      </tbody>
    </table>

    <div class="ui spacer"></div>

    <button id="verifyCode" class="ui basic mini {{ #if verified }}positive disabled{{ /if }} button">
      {{ #if verified }}
        Voting is {{ verified }}
      {{ else }}
        Verify contract's code
      {{/if}}
    </button>

    {{#if canVote}}
    <div class="ui icon small message">
      <i class="info icon"></i>
      <div class="content">
        <div class="header">You will cast {{ votingPower }} votes.</div>
      </div>
    </div>
    <div class="ui two buttons">
      {{#each options}}
      <button data-option="{{@index}}" class="ui {{#if $eq @index (plus options.length -1)}} negative {{else}} positive {{/if}} voting button">{{this}}</button>
      {{#unless $eq @index (plus options.length -1) }}
        <div class="or"></div>
      {{/unless}}
      {{/each}}
    </div>
    {{/if }}

    {{#with executingOption voteCounts options updatesHack }}
    <div class="ui icon small message">
      <i class="info icon"></i>
      <div class="content">
        <div class="header">Vote is called, it can be executed at any time.</div>
      </div>
    </div>
    <button class="ui big {{ sentiment }} execute button" data-option="{{index}}" name="button">Execute {{name}}</button>
    {{/with}}
    {{/with}}
  </div>
</template>
