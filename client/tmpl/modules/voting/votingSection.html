<template name="Module_Voting_Section">
  {{> Element_ProcessDimmer}}
  {{> Element_CloseSectionButton href='/voting'}}
  <div class="ui attached flex container" id="votingSection">
    {{#with voting}}
    <h1 class="ui header">
      {{title}}
      {{#if isNull voteExecuted}}
        <a class="ui red basic label">Ends in {{ timeRange now closingTime }}</a>
        {{#if supportNeeded}}
        <a class="ui violet label">Requires {{ percentFormat supportNeeded }} support</a>
        {{/if}}

        {{#if relativeMajorityOnClose}}
          <span class="popups" data-html="When voting close time passes, it will be considered approved if {{ percentFormat supportNeeded }} of all votes casted are positive." data-position="bottom center" data-variation="tiny" data-inverted=""><a class="ui violet basic label">Relative count on close</a></span>
        {{else}}
          <span class="popups" data-html="{{ percentFormat supportNeeded }} of all the company voting power need to approve this voting in the specified time frame." data-position="bottom center" data-variation="tiny" data-inverted=""><a class="ui violet label">Absolute count on close </a></span>
        {{/if}}
      {{else}}
        <a class="ui left pointing red basic label">Closed</a>
        <a class="ui violet label">{{arrayAccess options voteExecuted}}</a>
      {{/if}}
      <div class="sub header">{{description}}</div>
    </h1>

    <div class="ui hidden divider"></div>
    <label>Created by:</label>
    {{ > Element_MiniEntity entity=(getEntity creator) }}

    <table class="ui very basic padded fixed table" id="optionsTable">
      <thead>
        <tr>
          <th>Option</th>
          <th class="center aligned">Votes</th>
          <th class="center aligned">Absolute <span class="popups" data-html="Percentage of all voting power supporting an option." data-position="bottom center" data-variation="tiny" data-inverted=""><i class="ui info circle icon"></i></span></th>
          <th class="center aligned">Relative <span class="popups" data-html="Percentage of all casted votes supporting an option." data-position="bottom center" data-variation="tiny" data-inverted=""><i class="ui info circle icon"></i></span></th>
        </tr>
      </thead>
      <tbody>
        {{ #each options }}
        <tr data-option="{{ @index }}" class="{{ #if isExecuted @index }} bold {{ /if }}">
          <td>
            {{ this }}
          </td>
          {{#with arrayAccess voteCounts @index updatesHack }}
          <td class="center aligned">
            {{ votes }}
          </td>
          <td class="center aligned">
            {{ percentFormat absoluteVotes }}
          </td>
          <td class="center aligned">
            {{ percentFormat relativeVotes }}
          </td>
          {{/with}}
        </tr>
        {{/each}}
        {{#unless isClosed this }}
        <tr>
          <td>Pending votes</td>
          {{#with pendingVotes options updatesHack }}
          <td class="center aligned">{{ votes }}</td>
          <td class="center aligned">{{ percentFormat relativeVotes }}</td>
          <td class="center aligned">-</td>
          {{/with}}
        </tr>
        {{/unless}}
      </tbody>
    </table>

    <div class="ui spacer"></div>

    <button id="verifyCode" class="ui basic mini {{ #if verified }}positive disabled{{ /if }} button">
      {{ #if verified }}
        Voting is {{ verified }}
      {{ else }}
        Verify contract's code
      {{/if}}
    </button>

    {{#if canVote}}
    <div class="ui icon small message">
      <i class="info icon"></i>
      <div class="content">
        <div class="header">You will cast {{ votingPower }} votes.</div>
      </div>
    </div>
    <div class="ui two buttons">
      {{#each options}}
      <button data-option="{{@index}}" class="ui {{#if $eq @index (plus options.length -1)}} negative {{else}} positive {{/if}} voting button">{{this}}</button>
      {{#unless $eq @index (plus options.length -1) }}
        <div class="or"></div>
      {{/unless}}
      {{/each}}
    </div>
    {{/if }}

    {{#with executingOption voteCounts options updatesHack }}
    <div class="ui icon small message">
      <i class="info icon"></i>
      <div class="content">
        <div class="header">Vote is called, it can be executed at any time.</div>
      </div>
    </div>
    <button class="ui big {{ sentiment }} execute button" data-option="{{index}}" name="button">Execute {{name}}</button>
    {{/with}}
    {{/with}}
  </div>
</template>
